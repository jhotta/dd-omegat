

<!DOCTYPE html>
<html lang="en">
    <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>Deploying the Agent with Chef</title>
    

    <meta itemprop="description" name="description" property="og:description" content="" />

    <link href="//fonts.googleapis.com/css?family=Open+Sans:700" rel="stylesheet" type="text/css">
    <link href="/static/css/bootstrap3-cbdde23cd71.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/tipuesearch.css">
    <link href="/static/css/style-cba6fad8d5d.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="/static/pygments.css" media="screen">


    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>


    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-21102638-5']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
    <script src="https://use.fontawesome.com/700fac0342.js"></script>
    
  </head>

  <body>
    <!-- HEADER -->
<div class="navbar navbar-static-top">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#topmenu" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand " href="/ja/">
        <img src="/static/dd_docs_logo.png">
      </a>
    </div>
    <div class="collapse navbar-collapse" id="topmenu">
      <ul class="nav navbar-nav navbar-right">
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">ガイド <span class="caret"></span></a>
          <ul class="dropdown-menu">
          
            
              <li>
                <a href="/ja/overview/">Datadogが提供するサービスの概要</a>
              </li>
              
              <li>
                <a href="/ja/guides/basic_agent_usage/">Datadog Agent 入門</a>
              </li>
              
              <li>
                <a href="/ja/guides/metrics/">DogStatsD を使った、メトリクスの送信</a>
              </li>
              
              <li>
                <a href="/ja/guides/logs/">Datadog Agent によるログの解析方法</a>
              </li>
              
              <li>
                <a href="/ja/guides/hostmap/">Host Map表示の入門</a>
              </li>
              
              <li>
                <a href="/ja/guides/agent_checks/">Agent Checkの書き方</a>
              </li>
              
              <li>
                <a href="/ja/guides/azure/">Azure WindowsへDatadog Agentのインストール</a>
              </li>
              
              <li>
                <a href="/ja/guides/monitors/">Monitor(監視)機能の設定ガイド</a>
              </li>
              
              <li>
                <a href="/ja/guides/templating/">ダッシュボードのテンプレートの作成方法</a>
              </li>
              
              <li>
                <a href="/ja/guides/eventsemail/">メールによるイベント情報の送信</a>
              </li>
              
          </ul>
        </li>
        <li class="dropdown">
          <a id="nav-reference-dropdown" href="#" role="button" class="dropdown-toggle" data-toggle="dropdown">レファレンス <b class="caret"></b></a>
          <ul class="dropdown-menu dropdown-menu-left" role="menu" aria-labelledby="nav-guide-dropdown">
            <li><a href="/ja/api/">APIレファレンス</a></li>
            <li><a href="/ja/tracing/">Tracing (APM)</a></li>
            <li><a href="/ja/libraries/">APIライブラリー</a></li>
            <li><a href="/ja/monitoring/">アラート設定</a></li>
            <li><a href="/ja/graphing/">グラフ表示入門</a></li>
            <li><a href="/graphingjson/">JSONを使ったグラフの設定</a></li>
            <li><a href="/ja/hostnames/">ホスト名について</a></li>
            <li><a href="/ja/integrations/">インテグレーション</a></li>
            <li><a href="/ja/guides/dogstatsd/">DogStatsDの解説</a></li>
            <li><a href="/ja/examples/">サンプルコード</a></li>
            <li><a href="/ja/videos/">ビデオ</a></li>
            <li><a href="/ja/guides/billing/">課金に関するFAQ</a></li>
            <li><a href="/ja/faq/">FAQ</a></li>
          </ul>
        </li>
        
        <li><a href="/ja/help/">お問い合わせ</a></li>
        <li id="signin">
          <a class="btn navbar-btn flexbutton blueflex" href="https://app.datadoghq.com/signup">無料体験</a>
        </li>
        <li id="signup">
          <a class="btn navbar-btn flexbutton" href="https://help.datadoghq.com/hc/en-us/signin?return_to=https%3A%2F%2Fhelp.datadoghq.com%2Fhc%2Fen-us&locale=1">サポートログイン</a>
        </li>
      </ul>
    </div>
  </div>
</div>
<!-- END HEADER -->

    <div class="container">
      <div class="row">
      
        <!-- SIDEBAR -->
        <div class="col-sm-3 col-md-3 hidden-xs hidden-print" id="sidebarcolumn">
          <ul class="nav nav-tabs nav-stacked sidebar">
          
            <li class='nav-header'>Table of Contents</li><li><a style='' href='#overview' onclick="$('#').collapse('show')">
Overview</a></li><li><a style='' href='#deployagent' onclick="$('#').collapse('show')">
Deploying the Agent</a></li><li><a style='' href='#deployhandler' onclick="$('#').collapse('show')">
Deploying the Handler</a></li><li><a style='' href='#customizations' onclick="$('#').collapse('show')">
Customizations</a></li>
            
            
              <li class="nav-header">ガイド </li>
              
              
                <li><a href="/ja/overview/">Datadogが提供するサービスの概要</a></li>
              
                <li><a href="/ja/guides/basic_agent_usage/">Datadog Agent 入門</a></li>
              
                <li><a href="/ja/guides/metrics/">DogStatsD を使った、メトリクスの送信</a></li>
              
                <li><a href="/ja/guides/logs/">Datadog Agent によるログの解析方法</a></li>
              
                <li><a href="/ja/guides/hostmap/">Host Map表示の入門</a></li>
              
                <li><a href="/ja/guides/agent_checks/">Agent Checkの書き方</a></li>
              
                <li><a href="/ja/guides/azure/">Azure WindowsへDatadog Agentのインストール</a></li>
              
                <li><a href="/ja/guides/monitors/">Monitor(監視)機能の設定ガイド</a></li>
              
                <li><a href="/ja/guides/templating/">ダッシュボードのテンプレートの作成方法</a></li>
              
                <li><a href="/ja/guides/eventsemail/">メールによるイベント情報の送信</a></li>
              
            
          </ul>
        &nbsp;
        </div>
        <!-- END SIDEBAR -->
        
        <!-- MAIN -->
        <div class="col-xs-12 col-sm-9 col-md-9 main">
          <!-- PAGE TITLE -->
          
          <h1 id="pagetitle">Deploying the Agent with Chef </h1>
          
          
          <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body>
<div class="alert alert-info">
<strong>NOTICE:</strong> アクセスいただきありがとうございます。こちらのページは現在英語のみのご用意となっております。引き続き日本語化の範囲を広げてまいりますので、皆様のご理解のほどよろしくお願いいたします。</div>

<!--
======================================================
OVERVIEW
======================================================
-->

<h3 id="overview" class="linked-header">
<a class="header-link" href="#overview"><i class="fa fa-link"></i></a>Overview</h3>

<p>In this guide, we will explore how to leverage <a href="https://www.chef.io/chef/">Chef</a>
to automate installation of the Datadog Agent</p>

<p>Deploying Datadog with Chef is meant to be very simple, and provide you with a method of getting the value of monitoring across all of your infrastructure as simply as possible.</p>

<p>We also provide a Chef <a href="https://docs.chef.io/handlers.html">Execution and Report Handler</a> that can capture <code>chef-client</code> failures as well as metrics related to the Chef run, such as timing and resources updated.</p>

<!--
======================================================
DEPLOYING THE AGENT
======================================================
-->

<h3 id="deployagent" class="linked-header">
<a class="header-link" href="#deployagent"><i class="fa fa-link"></i></a>Deploying the Agent</h3>

<p>We created a cookbook to assist with Agent deployment.</p>

<p>Install the latest released version of the Datadog Chef cookbook from the <a href="https://supermarket.chef.io/cookbooks/datadog">Community Site</a> via knife, and upload to your Chef Server:</p>

<pre><code>knife cookbook site install datadog
knife cookbook upload datadog
</code></pre>

<p>You may also be using another tool to manage your cookbook workflow, such as <a href="http://berkshelf.com/">Berkshelf</a> or <a href="https://github.com/applicationsonline/librarian-chef">Librarian Chef</a>, in which case you will need to add a line like this to your Berksfile/Cheffile:</p>

<pre><code>cookbook 'datadog'
</code></pre>

<p>And follow the instructions for your tool to upload the cookbook to your Chef Server.</p>

<p>Before adding the cookbook’s recipe to your node’s <code>run_list</code>, you need to add account-specific details to be provided to the Agent configuration file.</p>

<p>This is commonly done via <code>role</code> or <code>environment</code> files, or another cookbook declaring the attributes.</p>

<p>Here is an example of a <code>base.rb</code> role file, typically applied to every host in an organization.</p>

<pre class="code-block code-block-ruby" lang="ruby"><code class="language-ruby"># Make sure you replace the API and/or APP key below
# with the ones for your account

name 'base'
description 'base role, runs on every node'
run_list(
  'ntp',
  'datadog::dd-agent',
  'some_other_base_cookbook::recipe'
)
default_attributes(
  'datadog' =&gt; {
    'api_key' =&gt; "PUT_YOUR_API_KEY_HERE",
    'application_key' =&gt; "PUT_YOUR_APPLICATION_KEY_HERE"
  }
)
</code></pre>

<p>Note that there are two keys needed. Your API Key can be found in Datadog, under the Integrations =&gt; API menu item, or click <a href="https://app.datadoghq.com/account/settings#api">this link</a> to log in and go there directly.</p>

<p>Then, on the same page, you must create an Application Key for use with Chef. You may name the key whatever you wish, we recommend something like ‘chef_appkey’ or something of that nature.</p>

<p>Provide both values in the attributes as shown above.</p>

<p>Then upload your role file to Chef Server like so:</p>

<pre><code>knife role from file roles/base.rb
</code></pre>

<p>The next time Chef runs, it should install the Agent and set the configuration file with the API and application keys.</p>

<p><strong>NOTE:</strong> If you are using another cookbook to define these attributes, use a higher attribute precedence level than <code>default</code>.</p>

<!--
======================================================
DEPLOYING THE HANDLER
======================================================
-->

<h3 id="deployhandler" class="linked-header">
<a class="header-link" href="#deployhandler"><i class="fa fa-link"></i></a>Deploying the Handler</h3>

<p>In order to further raise the visibility of your Chef runs, you may use the Datadog Chef Handler to monitor your Chef execution.</p>

<p>This has the added value of bringing the output of a Chef run back to Datadog’s Event stream, so failures can be highlighted quickly, discussed amongst the team, and resolved.</p>

<p>Successes typically will be found in the “Low” priority, whereas failures are of “Normal” priority, and when the same node passes the Chef run, then it is put pack into “Low” priority.</p>

<p>Adding the handler is very simple, as you can see in this role snippet:</p>

<pre class="code-block code-block-ruby" lang="ruby"><code class="language-ruby"># Make sure you replace the API and/or APP key below
# with the ones for your account

name 'base'
description 'base role, runs on every node'
run_list(
  'datadog::dd-handler',
  'ntp',
  'datadog::dd-agent',
  'some_other_base_cookbook::recipe'
)
default_attributes(
  'datadog' =&gt; {
    'api_key' =&gt; "PUT_YOUR_API_KEY_HERE",
    'application_key' =&gt; "PUT_YOUR_APPLICATION_KEY_HERE"
  }
)
</code></pre>

<p>All we’ve done is add the <code>datadog::dd-handler</code> recipe to the beginning of the node’s run list. Adding it to the beginning allows the handler to capture details about everything in it observes after being invoked, so if you added it to the end of the <code>run_list</code> and something failed prior to it being executed, you may not receive the full output.</p>

<p>Once set, upload the role to your Chef Server, and wait. After Chef has run on a few hosts, a new automatic Dashboard will be created, with the relevant Chef Metrics. You can find it in your <a href="https://app.datadoghq.com/dash/list">Dashboards List</a>, on the right-hand side.</p>

<!--
======================================================
CUSTOMIZATIONS
======================================================
-->

<h3 id="customizations" class="linked-header">
<a class="header-link" href="#customizations"><i class="fa fa-link"></i></a>Customizations</h3>

<p>The Datadog Chef Cookbook provides more integration-specific recipes.</p>

<p>Including one of these recipes in your run list will install any monitoring dependencies, such as any Python modules that are required to monitor that service, as well as write out the correct configuration file.</p>

<p>Here’s an example of how we’ve extended a <code>webserver.rb</code> role file to automatically monitor Apache via Datadog:</p>

<pre class="code-block code-block-ruby" lang="ruby"><code class="language-ruby">name 'webserver'
description 'Webserver role, runs apache'
run_list(
  'apache2',
  'datadog::apache',
)
default_attributes(
  'apache' =&gt; {
    'ext_status' =&gt; true,
  }
  'datadog' =&gt; {
    'apache' =&gt; {
      'instances' =&gt; [
        { 'status_url' =&gt; 'http://localhost:8080/server-status/',
          'tags' =&gt; ['extra_tag', 'env:example'] }
      ]
    }
  }
)
</code></pre>

<p>As you can see, we’ve added the <code>datadog::apache</code> recipe to the run list, and provided some attributes to control what instances of Apache should be monitored by Datadog.</p>

<p>Read each recipe file for the exact details of the integration values to pass into the <code>instances</code> part of the attributes.</p>
</body></html>


          
        </div>
      </div>
    </div>
    <div class="container">
  <div class="row" id="footer">
    <div class=".col-md-12">お困りの場合は、 <a href="/ja/help/">お気軽にお声がけ下さい。</a> &bull; ドキュメント内の不備を見つけた場合は、 <a href="https://github.com/DataDog/documentation/issues">ご連絡を頂けると助かります。</a></div>
    <div class=".col-md-12"><a href="/">Read the docs in English</a></div>
    <div class=".col-md-12">&copy; Datadog, Inc. All rights reserved.</div>
  </div>
</div>

    

        <script type="text/javascript">
      ;(function(p,l,o,w,i,n,g){if(!p[i]){p.GlobalSnowplowNamespace=p.GlobalSnowplowNamespace||[];
      p.GlobalSnowplowNamespace.push(i);p[i]=function(){(p[i].q=p[i].q||[]).push(arguments)
      };p[i].q=p[i].q||[];n=l.createElement(o);g=l.getElementsByTagName(o)[0];n.async=1;
      n.src=w;g.parentNode.insertBefore(n,g)}}(window,document,"script","https://don08600y3gfm.cloudfront.net/ps3b/static/js/plow232.js","snowplow"));
      window.snowplow('newTracker', 'co', 'collector.datadoghq.com', { // Initialise a tracker
      appId: 'datadog', // Application ID. Make sure you use the same value across all the tags you fire on your trial
      platform: 'web',
      cookieDomain: '.datadoghq.com',
      contexts: {
        performanceTiming: true,
        webPage: true
        }
      });
      window.snowplow('enableActivityTracking', 5, 5); // Ping every 30 seconds after 30 seconds
      window.snowplow('enableLinkClickTracking');
      window.snowplow('trackPageView');
    </script>

        <script type="text/javascript">
      (function() {
       var didInit = false;
       function initMunchkin() {
         if(didInit === false) {
           didInit = true;
           Munchkin.init('875-UVY-685');
         }
       }
       var s = document.createElement('script');
       s.type = 'text/javascript';
       s.async = true;
       s.src = '//munchkin.marketo.net/munchkin.js';
       s.onreadystatechange = function() {
         if (this.readyState == 'complete' || this.readyState == 'loaded') {
           initMunchkin();
         }
       };
       s.onload = initMunchkin;
       document.getElementsByTagName('head')[0].appendChild(s);
      })();
    </script>


    <!-- <script src="/static/jquery-1.7.2.min.js"></script> -->
<script src="/static/bootstrap/js/bootstrap.min.js"></script>
<script type="text/javascript" src="/tipuesearch/tipuesearch-set.js"></script>
<script type="text/javascript" src="/tipuesearch/tipuesearch_content.js"></script>
<script type="text/javascript" src="/tipuesearch/tipuesearch.js"></script>
<script src="/static/datadog-docs.js"></script>


    <!-- No page Javascript -->
  </body>
</html>


