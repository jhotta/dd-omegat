

<!DOCTYPE html>
<html lang="en">
    <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>Log Parsing in the Agent</title>
    

    <meta itemprop="description" name="description" property="og:description" content="" />

    <link href="//fonts.googleapis.com/css?family=Open+Sans:700" rel="stylesheet" type="text/css">
    <link href="/static/css/bootstrap3-cbdde23cd71.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/tipuesearch.css">
    <link href="/static/css/style-cba6fad8d5d.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="/static/pygments.css" media="screen">


    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>


    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-21102638-5']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
    <script src="https://use.fontawesome.com/700fac0342.js"></script>
    
  </head>

  <body>
    <!-- HEADER -->
<div class="navbar navbar-static-top">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#topmenu" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand " href="/">
        <img src="/static/dd_docs_logo.png">
      </a>
    </div>
    <div class="collapse navbar-collapse" id="topmenu">
      <ul class="nav navbar-nav navbar-right">
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Guides <span class="caret"></span></a>
          <ul class="dropdown-menu">
          
            
              <li>
                <a href="/guides/basic_agent_usage/">Getting Started with the Agent</a>
              </li>
              
              <li>
                <a href="/guides/overview/">Datadog Overview</a>
              </li>
              
              <li>
                <a href="/guides/hostmap/">Host Map Overview</a>
              </li>
              
              <li>
                <a href="/guides/integration_sdk/">Creating New Integrations</a>
              </li>
              
              <li>
                <a href="/guides/installcoreextra/">Installing Core & Extra Integrations</a>
              </li>
              
              <li>
                <a href="/guides/eventcorrelation/">Correlating Events with Metrics</a>
              </li>
              
              <li>
                <a href="/guides/metrics/">Sending Metrics with DogStatsD</a>
              </li>
              
              <li>
                <a href="/guides/logs/">Log Parsing in the Agent</a>
              </li>
              
              <li>
                <a href="/guides/testing/">Testing Integrations</a>
              </li>
              
              <li>
                <a href="/guides/agent_checks/">Writing an Agent Check</a>
              </li>
              
              <li>
                <a href="/guides/chef/">Deploying the Agent with Chef</a>
              </li>
              
              <li>
                <a href="/guides/azure/">Deploying the Datadog Agent to Azure</a>
              </li>
              
              <li>
                <a href="/guides/monitors/">Guide to Monitors</a>
              </li>
              
              <li>
                <a href="/guides/composite_monitors/">Guide to Composite Monitors</a>
              </li>
              
              <li>
                <a href="/guides/markdown/">Using Markdown in Datadog events</a>
              </li>
              
              <li>
                <a href="/guides/autodiscovery/">Guide to using Autodiscovery with Docker</a>
              </li>
              
              <li>
                <a href="/guides/tagging/">Guide to Tagging</a>
              </li>
              
              <li>
                <a href="/guides/templating/">Guide to Dashboard Templating</a>
              </li>
              
              <li>
                <a href="/guides/saml/">Single Sign On With SAML</a>
              </li>
              
              <li>
                <a href="/guides/eventsemail/">Events via Email</a>
              </li>
              
              <li>
                <a href="/guides/new_integration/">Officially Integrating with Datadog</a>
              </li>
              
              <li>
                <a href="/guides/anomalies/">Anomaly Detection</a>
              </li>
              
              <li>
                <a href="/guides/outliers/">Outlier Detection</a>
              </li>
              
              <li>
                <a href="/guides/multiaccountorg/">Configuring Teams & Organizations with Multiple Accounts</a>
              </li>
              
          </ul>
        </li>
        <li class="dropdown">
          <a id="nav-reference-dropdown" href="#" role="button" class="dropdown-toggle" data-toggle="dropdown">References <b class="caret"></b></a>
          <ul class="dropdown-menu dropdown-menu-left" role="menu" aria-labelledby="nav-guide-dropdown">
            <li><a href="/api/">API</a></li>
            <li><a href="/tracing/">Tracing (APM)</a></li>
            <li><a href="/libraries/">Libraries</a></li>
            <li><a href="/monitoring/">Monitoring</a></li>
            <li><a href="/graphing/">Graphing</a></li>
            <li><a href="/graphingjson/">Graphing using JSON</a></li>
            <li><a href="/hostnames/">Host Names</a></li>
            <li><a href="/integrations/">Integrations</a></li>
            <li><a href="/guides/dogstatsd/">DogStatsD</a></li>
            <li><a href="/examples/">Examples</a></li>
            <li><a href="/videos/">Videos</a></li>
            <li><a href="/guides/billing/">Billing</a></li>
            <li><a href="/faq/">FAQ</a></li>
          </ul>
        </li>
        
        <li class="hidden-sm hidden-md hidden-lg">
          <form class="navbar-form navbar-left" role="search" action="/search/">
            <div class="form-group">
              <input type="text" name="q" id="tipue_search_input" required class="form-control" placeholder="Search">
            </div>
          </form>
        </li>
        
        <li><a href="/help/">Help</a></li>
        <li id="signin">
          <a class="btn navbar-btn flexbutton blueflex" href="https://app.datadoghq.com/signup">Free Trial</a>
        </li>
        <li id="signup">
          <a class="btn navbar-btn flexbutton" href="https://help.datadoghq.com/hc/en-us/signin?return_to=https%3A%2F%2Fhelp.datadoghq.com%2Fhc%2Fen-us&locale=1">Support Login</a>
        </li>
      </ul>
    </div>
  </div>
</div>
<!-- END HEADER -->

    <div class="container">
      <div class="row">
      
        <!-- SIDEBAR -->
        <div class="col-sm-3 col-md-3 hidden-xs hidden-print" id="sidebarcolumn">
          <ul class="nav nav-tabs nav-stacked sidebar">
          
            <li class="nav-header">Documentation Search</li>
            <li>
              <form action="/search/">
                <input type="text" name="q" id="tipue_search_input" autocomplete="off" required>
              </form>
            </li>
            
            <li class='nav-header'>Table of Contents</li><li><a href='#metrics' onclick="$('#').collapse('show')">Parsing Metrics</a></li><li><a href='#events' onclick="$('#').collapse('show')">Parsing Events</a></li>
            
            
              <li class="nav-header">Guides </li>
              
              
                <li><a href="/guides/basic_agent_usage/">Getting Started with the Agent</a></li>
              
                <li><a href="/guides/overview/">Datadog Overview</a></li>
              
                <li><a href="/guides/hostmap/">Host Map Overview</a></li>
              
                <li><a href="/guides/integration_sdk/">Creating New Integrations</a></li>
              
                <li><a href="/guides/installcoreextra/">Installing Core & Extra Integrations</a></li>
              
                <li><a href="/guides/eventcorrelation/">Correlating Events with Metrics</a></li>
              
                <li><a href="/guides/metrics/">Sending Metrics with DogStatsD</a></li>
              
                <li><a href="/guides/logs/">Log Parsing in the Agent</a></li>
              
                <li><a href="/guides/testing/">Testing Integrations</a></li>
              
                <li><a href="/guides/agent_checks/">Writing an Agent Check</a></li>
              
                <li><a href="/guides/chef/">Deploying the Agent with Chef</a></li>
              
                <li><a href="/guides/azure/">Deploying the Datadog Agent to Azure</a></li>
              
                <li><a href="/guides/monitors/">Guide to Monitors</a></li>
              
                <li><a href="/guides/composite_monitors/">Guide to Composite Monitors</a></li>
              
                <li><a href="/guides/markdown/">Using Markdown in Datadog events</a></li>
              
                <li><a href="/guides/autodiscovery/">Guide to using Autodiscovery with Docker</a></li>
              
                <li><a href="/guides/tagging/">Guide to Tagging</a></li>
              
                <li><a href="/guides/templating/">Guide to Dashboard Templating</a></li>
              
                <li><a href="/guides/saml/">Single Sign On With SAML</a></li>
              
                <li><a href="/guides/eventsemail/">Events via Email</a></li>
              
                <li><a href="/guides/new_integration/">Officially Integrating with Datadog</a></li>
              
                <li><a href="/guides/anomalies/">Anomaly Detection</a></li>
              
                <li><a href="/guides/outliers/">Outlier Detection</a></li>
              
                <li><a href="/guides/multiaccountorg/">Configuring Teams & Organizations with Multiple Accounts</a></li>
              
            
          </ul>
        &nbsp;
        </div>
        <!-- END SIDEBAR -->
        
        <!-- MAIN -->
        <div class="col-xs-12 col-sm-9 col-md-9 main">
          <!-- PAGE TITLE -->
          
          <h1 id="pagetitle">Log Parsing in the Agent </h1>
          
          
          <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body>
<p>Log files contain tons of valuable application and business data.
Unfortunately, this value is oftentimes never realized because log files go
ignored. The Datadog Agent can help remedy this by parsing metrics and events from
logs, so the data within can be graphed in real-time, all the time.</p>

<h2 id="metrics" class="linked-header">
<a class="header-link" href="#metrics"><i class="fa fa-link"></i></a>Parsing Metrics</h2>

<p>The Datadog Agent can read metrics directly from your log files:</p>

<ul>
  <li>from the Datadog canonical log format, without any additional programming</li>
  <li>from any other log format, with a customized log parsing function</li>
</ul>

<h3 id="datadog-canonical-log-format" class="linked-header">
<a class="header-link" href="#datadog-canonical-log-format"><i class="fa fa-link"></i></a>Datadog Canonical Log Format</h3>

<p>Datadog logs are formatted as follows:</p>

<pre><code>metric unix_timestamp value [attribute1=v1 attributes2=v2 ...]
</code></pre>

<p>For example, imagining the content of <code>/var/log/web.log</code> to be:</p>

<pre><code>me.web.requests 1320786966 157 metric_type=counter unit=request
me.web.latency 1320786966 250 metric_type=gauge unit=ms
</code></pre>

<p>Then all you need for Datadog to read metrics is to add this line to your Agent
configuration file (usually at <code>/etc/dd-agent/datadog.conf</code>):</p>

<pre><code>dogstreams: /var/log/web.log
</code></pre>

<p>You can also specify multiple log files like this:</p>

<pre><code>dogstreams: /var/log/web.log, /var/log/db.log, /var/log/cache.log
</code></pre>

<h3 id="parsing-custom-log-formats" class="linked-header">
<a class="header-link" href="#parsing-custom-log-formats"><i class="fa fa-link"></i></a>Parsing Custom Log Formats</h3>

<p>If you want to parse a different log format - say for a piece of vendor
or legacy software - you can use a custom Python function to extract the proper
fields from the log by specifying your log file in your Agent configuration
file in the following format:</p>

<pre><code>dogstreams: /var/log/web.log:parsers:parse_web
</code></pre>

<p>The <code>parsers:parse_web</code> portion indicates that the custom Python function lives
in a package called  parsers in the Agent’s <code>PYTHONPATH</code>, and the parsers package
has a function named <code>parse_web</code>. The Agent’s <code>PYTHONPATH</code> is set in the Agent
startup script, <code>/etc/init.d/datadog-agent</code> for Agent versions &lt; 2.0, and in the
supervisor config for Agent version &gt;= 2.0.</p>

<p>If your parser does <strong>not</strong> live on the Agent’s <code>PYTHONPATH</code>, you can use an
alternative syntax to configure your line parser:</p>

<pre><code>dogstreams: /path/to/log1:/path/to/my/parsers_module.py:custom_parser
</code></pre>

<p>In this format, the agent will attempt to import a function called
<code>custom_parser</code> from <code>/path/to/my/parsers_module.py</code>.</p>

<p>If your custom log parser is not working, the first place to check is the
Agent collector logs. If the Agent is unable to import your function, there will
be a line with <code>Could not load Dogstream line parser</code>. (On the other hand, if
all goes well you should see <code>dogstream: parsing {filename} with
{function name} (requested {config option text})</code>.)</p>

<h3 id="writing-parsing-functions" class="linked-header">
<a class="header-link" href="#writing-parsing-functions"><i class="fa fa-link"></i></a>Writing Parsing Functions</h3>

<p>Custom parsing functions must:</p>

<ul>
  <li>take two parameters: a Python logger object (for debugging) and a string parameter of the current line to parse.</li>
  <li>
    <p>return a tuple or list of tuples of the form:</p>

    <p><code>(metric (str), timestamp (unix timestamp), value (float), attributes (dict))</code></p>

    <p>Where attributes should at least contain the key metric_type, specifying whether the given metric is a counter or gauge.</p>

    <p>If the line doesn’t match, instead return <code>None</code>.</p>
  </li>
</ul>

<h3 id="example" class="linked-header">
<a class="header-link" href="#example"><i class="fa fa-link"></i></a>Example</h3>

<p>Here’s an example of what <code>parsers.py</code> might contain:</p>

<pre class="" lang="python"><code class="language-python">import time
from datetime import datetime

def parse_web(logger, line):
    # Split the line into fields
    date, metric_name, metric_value, attrs = line.split('|')

    # Convert the iso8601 date into a unix timestamp, assuming the timestamp
    # string is in the same timezone as the machine that's parsing it.
    date = datetime.strptime(date, "%Y-%m-%dT%H:%M:%S")
    date = time.mktime(date.timetuple())

    # Remove surrounding whitespace from the metric name
    metric_name = metric_name.strip()

    # Convert the metric value into a float
    metric_value = float(metric_value.strip())

    # Convert the attribute string field into a dictionary
    attr_dict = {}
    for attr_pair in attrs.split(','):
        attr_name, attr_val = attr_pair.split('=')
        attr_name = attr_name.strip()
        attr_val = attr_val.strip()
        attr_dict[attr_name] = attr_val

    # Return the output as a tuple
    return (metric_name, date, metric_value, attr_dict)
</code></pre>

<p>You’ll want to be able to test your parser outside of the Agent, so for the above example,
you might add a test function like this:</p>

<pre class="" lang="python"><code class="language-python">def test():
    # Set up the test logger
    import logging
    logging.basicConfig(level=logging.DEBUG)

    # Set up the test input and expected output
    test_input = "2011-11-08T21:16:06|me.web.requests|157|metric_type=counter,unit=request"
    expected = (
        "me.web.requests",
        1320786966,
        157,
        {"metric_type": "counter",
         "unit":        "request" }
    )

    # Call the parse function
    actual = parse_web(logging, test_input)

    # Validate the results
    assert expected == actual, "%s != %s" % (expected, actual)
    print 'test passes'


if __name__ == '__main__':
    # For local testing, callable as "python /path/to/parsers.py"
    test()
</code></pre>

<p>And you can test your parsing logic by calling python /path/to/parsers.py.</p>

<h2 id="events" class="linked-header">
<a class="header-link" href="#events"><i class="fa fa-link"></i></a>Parsing Events</h2>

<p>Event parsing is done via the same custom parsing functions as described above, except if you return a
<code>dict</code> (or a <code>list</code> of <code>dict</code>) from your custom parsing function, Datadog will treat it as an event instead of a metric.</p>

<p>Here are the event fields (bold means the field is required):</p>

<table class="table">
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<th>msg_title</th>
<td>string</td>
<td>Title of the event. Will get indexed by our full-text
search.</td>
</tr>
<tr>
<td>timestamp</td>
<td>integer</td>
<td>Unix epoch timestamp. If omitted, will default to the time that
the Agent parsed the event.</td>
</tr>
<tr>
<td>msg_text</td>
<td>string</td>
<td>Body of the event. Will get indexed by our full-text
search.</td>
</tr>
<tr>
<td>alert_type</td>
<td>string enum</td>
<td>Indicates the severity of the event. Must be one of `error`,
`warning`, `success` or `info`. If omitted, will default to `info`.
Searchable by `alert_type:value`</td>
</tr>
<tr>
<td>event_type</td>
<td>string</td>
<td>Describes what kind of event this is. Used as part of the
aggregation key</td>
</tr>
<tr>
<td>aggregation_key</td>
<td>string</td>
<td>Describes what this event affected, if anything. Used as part
of the aggregation key</td>
</tr>
<tr>
<td>host</td>
<td>string</td>
<td>Name of the host this event originated from. The event will
automatically get tagged with any tags you've given this host using
the <a href="https://app.datadoghq.com/infrastructure#tags">tagging
page</a> or the <a href="/api/#tags">tagging
api</a>. The host value is used as part of the aggregation
key.</td>
</tr>
<tr>
<td>priority</td>
<td>string</td>
<td>Determines whether the event will be visible or hidden by default
in the stream; Must be one of <code>low</code> or <code>normal</code>
</td>
</tr>
</tbody>
</table>

<p>The events with the same aggregation key within a 24 hour time window will get aggregated together on the stream.
The aggregation key is a combination of the following fields:</p>

<ul>
  <li>event_type</li>
  <li>aggregation_key</li>
  <li>host</li>
</ul>

<p>For an example of an event parser, see our <a href="https://github.com/DataDog/dd-agent/blob/master/dogstream/cassandra.py">cassandra compaction event parser</a>
that is bundled with the Agent.</p>
</body></html>


          
        </div>
      </div>
    </div>
    <div class="container">
  <div class="row" id="footer">
    <div class=".col-md-12">Need some help?  <a href="/help/">Get in touch.</a> &bull; Mistake in the docs? <a href="https://github.com/DataDog/documentation/issues">Let us know.</a></div>
    <div class=".col-md-12"><a href="/ja">日本語ドキュメントへのリンク。</a></div>
    <div class=".col-md-12">&copy; Datadog, Inc. All rights reserved.</div>
  </div>
</div>

    

        <script type="text/javascript">
      ;(function(p,l,o,w,i,n,g){if(!p[i]){p.GlobalSnowplowNamespace=p.GlobalSnowplowNamespace||[];
      p.GlobalSnowplowNamespace.push(i);p[i]=function(){(p[i].q=p[i].q||[]).push(arguments)
      };p[i].q=p[i].q||[];n=l.createElement(o);g=l.getElementsByTagName(o)[0];n.async=1;
      n.src=w;g.parentNode.insertBefore(n,g)}}(window,document,"script","https://don08600y3gfm.cloudfront.net/ps3b/static/js/plow232.js","snowplow"));
      window.snowplow('newTracker', 'co', 'collector.datadoghq.com', { // Initialise a tracker
      appId: 'datadog', // Application ID. Make sure you use the same value across all the tags you fire on your trial
      platform: 'web',
      cookieDomain: '.datadoghq.com',
      contexts: {
        performanceTiming: true,
        webPage: true
        }
      });
      window.snowplow('enableActivityTracking', 5, 5); // Ping every 30 seconds after 30 seconds
      window.snowplow('enableLinkClickTracking');
      window.snowplow('trackPageView');
    </script>

        <script type="text/javascript">
      (function() {
       var didInit = false;
       function initMunchkin() {
         if(didInit === false) {
           didInit = true;
           Munchkin.init('875-UVY-685');
         }
       }
       var s = document.createElement('script');
       s.type = 'text/javascript';
       s.async = true;
       s.src = '//munchkin.marketo.net/munchkin.js';
       s.onreadystatechange = function() {
         if (this.readyState == 'complete' || this.readyState == 'loaded') {
           initMunchkin();
         }
       };
       s.onload = initMunchkin;
       document.getElementsByTagName('head')[0].appendChild(s);
      })();
    </script>


    <!-- <script src="/static/jquery-1.7.2.min.js"></script> -->
<script src="/static/bootstrap/js/bootstrap.min.js"></script>
<script type="text/javascript" src="/tipuesearch/tipuesearch-set.js"></script>
<script type="text/javascript" src="/tipuesearch/tipuesearch_content.js"></script>
<script type="text/javascript" src="/tipuesearch/tipuesearch.js"></script>
<script src="/static/datadog-docs.js"></script>


    <!-- No page Javascript -->
  </body>
</html>


